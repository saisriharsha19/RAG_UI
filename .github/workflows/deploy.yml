name: Deploy to GitHub Pages

on:
 push:
   branches: ["main"]
 workflow_dispatch:

permissions:
 contents: read
 pages: write
 id-token: write

jobs:
 build:
   runs-on: ubuntu-latest
   steps:
     - uses: actions/checkout@v4
     - uses: actions/setup-node@v4
       with:
         node-version: "18"
         cache: 'npm'
         cache-dependency-path: './chatbot-ui/package-lock.json'
     - uses: actions/configure-pages@v4
     - name: Install dependencies
       run: cd chatbot-ui && npm ci
     - name: Build
       run: cd chatbot-ui && npm run build
     - name: Add .nojekyll file
       run: touch chatbot-ui/out/.nojekyll
     - name: Check build output
       run: ls -la chatbot-ui/out/
     - name: Upload artifact
       uses: actions/upload-pages-artifact@v4
       with:
         path: './chatbot-ui/out'

 deploy:
   environment:
     name: github-pages
     url: ${{ steps.deployment.outputs.page_url }}
   runs-on: ubuntu-latest
   needs: build
   steps:
     - name: Deploy to GitHub Pages
       id: deployment
       uses: actions/deploy-pages@v4